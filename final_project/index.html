
<!DOCTYPE html>
<html>
  <head> 
    <title>Progetto Finale -  Andrea Olivieri</title> 
    <style>
      body{
        margin: 0;
        overflow: hidden;
      }

      #stats {  /* Align stats top-left */
        position: absolute;
        left: 0px;
        top: 0px;
      }
    </style> 
  </head>
  <body>
  <!-- JavaScript libraries -->
  <script type="text/javascript" src="assets/libs/jquery.min.js"></script> 
  <script type="text/javascript" src="assets/libs/three.min.js"></script>
  <script type="text/javascript" src="assets/libs/Stats.min.js"></script>
  <script type="text/javascript" src="assets/libs/dat.gui.min.js"></script>
  <script type="text/javascript" src="assets/libs/TrackballControls.js"></script>
  <script type="text/javascript" src="assets/libs/FirstPersonControls.js"></script>
  <script type="text/javascript" src="assets/libs/OBJLoader.js"></script> 
  <script type="text/javascript" src="assets/libs/MTLLoader.js"></script> 
  <script type="text/javascript" src="assets/libs/OBJMTLLoader.js"></script> 

  <script type="text/javascript" src="scripts/apartment.js"></script> 
  <script type="text/javascript" src="scripts/lamp.js"></script> 
  <script type="text/javascript" src="scripts/door.js"></script> 
  <script type="text/javascript" src="scripts/wallpaper.js"></script> 
  <script type="text/javascript" src="scripts/window.js"></script> 
  <!-- Javascript code that runs our Three.js examples --> 
  <script>
    // once everything is loaded, we run our Three.js stuff.
    $(Document).ready(function () {
      var clock = new THREE.Clock();

      var stats = initStats();

      // create a scene, that will hold all our elements such as objects, cameras and lights.
      var scene = new THREE.Scene();
      scene.name = 'Scene';

      // create a camera, which defines where we're looking at.
      var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.name = 'Camera';
      camera.position.set(0, -10, 20);
      camera.lookAt(new THREE.Vector3(0, 0, 0));

      // create trackball controls
      var trackballControls = new THREE.TrackballControls(camera);

/*
      var camControls = new THREE.FirstPersonControls(camera);
      camControls.lookSpeed = 0.05;
      camControls.movementSpeed = 2;
      camControls.activeLook = true;
      camControls.noFly = true;
      camControls.lookVertical = true;
      camControls.constrainVertical = true;
     // camControls.verticalMin = 1.0;
     // camControls.verticalMax = 2.0;
      camControls.lon = -150;
      camControls.lat = 120;
*/
      // create a render and set the size
      var webGLRenderer = new THREE.WebGLRenderer();
      webGLRenderer.setClearColor(new THREE.Color(0xaaaaff, 1.0));
      webGLRenderer.setSize(window.innerWidth, window.innerHeight);
      webGLRenderer.shadowMapEnabled = true;
    

      var axisHelper = new THREE.AxisHelper(10);
      axisHelper.name = 'Axis';
      scene.add(axisHelper);

      var projector = new THREE.Projector();

      // load apartment from obj  
      var apartment = addApartment(scene);       

      // load apartment from obj  
      addWallpapers(scene);       
      
      // Load Ceiling Lamps
      //var cLamps = addCeilingLamps(scene); 

      // Load Doors
      //var doors = addDoors(scene); 

      // Load Windows
      var windows = addWindows(scene); 

      // add spotlight for the shadows
      var spotLight = new THREE.SpotLight(0xffffff);
      spotLight.shadowCameraVisible = true;
      spotLight.position.set(30, 0, 10);
      spotLight.target.position.set( 0, 0, 0 );
      spotLight.intensity = 0.4;
      scene.add(spotLight);

      var spotLight = new THREE.SpotLight(0xffffff);
      spotLight.shadowCameraVisible = true;
      spotLight.position.set(-30, 0, 40);
      spotLight.target.position.set( 0, 0, 0 );
      spotLight.intensity = 0.4;
      scene.add(spotLight);

      var spotLight = new THREE.SpotLight(0xffffff);
      spotLight.shadowCameraVisible = true;
      spotLight.position.set(0, 30, 40);
      spotLight.target.position.set( 0, 0, 0 );
      spotLight.intensity = 0.4;
      scene.add(spotLight);

      var spotLight = new THREE.SpotLight(0xffffff);
      spotLight.shadowCameraVisible = true;
      spotLight.position.set(0, -30, 40);
      spotLight.target.position.set( 0, 0, 0 );
      spotLight.intensity = 0.4;
      scene.add(spotLight);
    

      // Add OnMouseDown Listener
      document.addEventListener('mousedown', onDocumentMouseDown, false);

      // add the output of the renderer to the html element
      $('body').append(webGLRenderer.domElement);

      // setup the control gui
      var controls = new function () {};
      var gui = new dat.GUI();

      render();

      function render() {
        stats.update();

        /*
        var delta = clock.getDelta();
        camControls.update(delta);
        */
        trackballControls.update();

        // render using requestAnimationFrame
        requestAnimationFrame(render);
        webGLRenderer.render(scene, camera);
      }

      function initStats() {
        var stats = new Stats();
        stats.setMode(0); // 0: fps, 1: ms
        $('body').append(stats.domElement);
        return stats;
      }

      function onDocumentMouseDown (event) {
        event.preventDefault();

        // map viewport coordinates in ([-1,1], [-1,1], 0.5)
        var vector = new THREE.Vector3(( event.clientX / window.innerWidth ) * 2 - 1, -( event.clientY / window.innerHeight ) * 2 + 1, 0.5);
        projector.unprojectVector(vector, camera);

        var raycaster = new THREE.Raycaster(camera.position, 
          vector.sub(camera.position).normalize());

        
        var intersects = raycaster.intersectObjects(cLamps,true);
        if (intersects.length > 0) {
          intersects[0].object.parent.parent.onMouseDown();
        }
        /*       
        intersects = raycaster.intersectObjects(doors,true);
        if (intersects.length > 0) {
          intersects[0].object.parent.parent.onMouseDown();
        }  

         */    
      }

    });
  </script>  
 </body>
</html>
